<!DOCTYPE html>
<html>
    <head>
        <h1>DoctorDog daily calories calculator</h1>
    </head>
    <body>
        <form method="post" name="dog_info">
            <label for="dog_name">Dog Name:</label><br>
            <input type="text" id="dog_name" name="dog_name"><br>
            <label for="dog_sex">Dog Sex:</label><br>
            <select name="dog_sex" id="dog_sex">
                <option value="0">Female</option>
                <option value="1">Male</option>
            </select><br>
            <label for="dog_weigth">Dog Weigth (kg):</label><br>
            <input type="number" id="dog_weigth" name="dog_weigth"><br>
            <label for="dog_birthday">Dog Birthday:</label><br>
            <input type="date" id="dog_birthday" name="dog_birthday"><br>
            <label for="bcs">Dog BCS (Body Condition Score):</label><br>
            <select name="bcs" id="bcs">
                <option value="0">1</option>
                <option value="1">2</option>
                <option value="2">3</option>
                <option value="3">4</option>
                <option value="4">5</option>
                <option value="5">6</option>
                <option value="6">7</option>
                <option value="7">8</option>
                <option value="8">9</option>
            </select><br>
            <label for="activity">Activity level:</label><br>
            <select name="activity" id="activity">
                <option value="0">Low</option>
                <option value="1">Standard</option>
                <option value="2">Good</option>
                <option value="3">High</option>
            </select><br>
            <label for="is_neutered">Neutered:</label><br>
            <input type="checkbox" name="is_neutered" id="is_neutered"><br>
            <label for="dog_status">Dog Current Status:</label><br>
            <select onchange="toggleStatusDivs()" name="dog_status" id="dog_status">
                <option value="0">None of the above</option>
                <option value="1">Pregnant</option>
                <option value="2">Lactating</option>
                <option value="3">Puppy</option>
            </select><br>
            <div id="pregnant" style="display: none;">
                <label for="gestation_period">Dog Gestation Period:</label><br>
                <select name="gestation_period" id="gestation_period">
                    <option value="0">4 weeks or less</option>
                    <option value="1">more than 4 weeks</option>
                </select><br>
            </div>
            <div id="lactating" style="display: none;">
                <label for="number_of_puppies">Number of puppies:</label><br>
                <input type="number" id="number_of_puppies" name="number_of_puppies"><br>
                <label for="current_weeks">Current lactation week:</label><br>
                <select name="current_weeks" id="current_weeks">
                    <option value="0">Week 1</option>
                    <option value="1">Week 2</option>
                    <option value="2">Week 3</option>
                    <option value="3">Week 4</option>
                </select><br>
            </div>
            <div id="puppy" style="display: none;">
                <label for="estimated_bw">Estimated Body Weigth:</label><br>
                <input type="number" id="estimated_bw" name="estimated_bw"><br>
            </div>
            <label for="living_condition">Mostly lives:</label><br>
            <select onchange="toggleSeasonDivs()" name="living_condition" id="living_condition">
                <option value="0">Inside</option>
                <option value="1">Outside</option>
            </select><br>
            <div id="season_div" style="display: none;">
            <label for="current_season">Current Season</label><br>
            <select name="current_season" id="current_season">
                <option value="0">Spring</option>
                <option value="1">Summer</option>
                <option value="2">Fall</option>
                <option value="3">Winter</option>
            </select><br>
        </div>
        </form>
        <button type="submit" onclick="calculate_calories()" form="dog_info" value="Submit">Calcola</button>
        <div id="results" style="display: none;">
            <b>Daily calories calculated: </b><br>
            <p id="calories"></p>
        </div>
    </body>
</html>

<script>
    function toggleStatusDivs(){
        status = document.getElementById("dog_status").value;
        document.getElementById("pregnant").style.display = status == 1 ? "block" : "none";
        document.getElementById("lactating").style.display = status == 2 ? "block" : "none";
        document.getElementById("puppy").style.display = status == 3 ? "block" : "none";
    }

    function toggleSeasonDivs(){
        lives_outside = document.getElementById("living_condition").value;
        document.getElementById("season_div").style.display = lives_outside == 1 ? "block" : "none";
    }

    function calculate_calories(){
        activity_values = [-0.15,0,0.15,0.35];
        bcs_values = [0.15,0.12,0.1,0.05,0,-0.05,-0.1,-0.12,-0.15]
        L_by_week = [0.75,0.95,1.1,1.2];
        document.getElementById("results").style.display = "block";
        ret = document.getElementById("calories");
        dog_sex = document.getElementById("dog_sex").value;
        dog_weigth = document.getElementById("dog_weigth").value;
        bw_pow = Math.pow(dog_weigth,0.75);
        birthday = document.getElementById("dog_birthday");
        bcs = document.getElementById("bcs").value;
        activity = document.getElementById("activity").value;
        is_neutered = document.getElementById("is_neutered").checked;
        lives_outside = document.getElementById("living_condition").value;
        current_season = document.getElementById("current_season").value
        status = document.getElementById("dog_status").value;
        today = Date.now();
        age = today - birthday.valueAsNumber;
        days = Math.floor(age / 1000 / 60 / 60 / 24);
        weeks = Math.floor(days/7);
        //months = Math.floor(days / 30);
        years = Math.floor(days / 365);
        switch (status) {
            case "0":
                
                energy_by_kg = days <= 2 ? 130 : days < 7 ? 110 : 95;
                base_energy = energy_by_kg * bw_pow;
                activity_multiplier = years >= 7 ? 0 : activity_values[activity];
                bcs_multiplier = bcs_values[bcs];
                outside_multiplier = lives_outside=="1" && current_season == "3" ? 0.15 : 0;
                neutered_multiplier = is_neutered == true ? -0.1 : 0;
                sex_multiplier = dog_sex == "0" ? -0.05 : 0;
                multiplier = activity_multiplier + bcs_multiplier + outside_multiplier + neutered_multiplier + sex_multiplier;
                energy = base_energy + (base_energy * multiplier);
                ret.innerHTML = energy + " kcalories/day";
                break;
            case "1":
                gestation_period = document.getElementById("gestation_period").value;
                energy = 0;
                if(gestation_period == "0"){
                    energy = 132 * bw_pow;
                }
                else {
                    energy = 132  * bw_pow + 26 * dog_weigth;
                }
                ret.innerHTML = energy + " kcalories/day";
                break;
            case "2":
                puppies_number = document.getElementById("number_of_puppies").value;
                current_week = document.getElementById("current_weeks").value;
                L = L_by_week[current_week];
                energy = 0;
                if(puppies_number <= 4){
                    energy = 145 * bw_pow + 24 * puppies_number * dog_weigth * L;
                }
                else{
                    energy = 145 * bw_pow + (96 + 12 * puppies_number) * dog_weigth * L;
                }
                ret.innerHTML = energy + " kcalories/day";
                break;
            case "3":
                ebw = document.getElementById("estimated_bw").value;
                energy = 0;
                if(weeks < 8){
                    energy = 25 / 100 * (dog_weigth*1000);
                }
                else{
                    energy = (254.1 - 135.0 * dog_weigth / ebw) * bw_pow;
                }
                ret.innerHTML = energy + " kcalories/day";
                break;
        
            default:
                break;
        }
    }
</script>